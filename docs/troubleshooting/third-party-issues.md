# Google OAuth認証機能 テストケース

## 概要
このドキュメントは、Google OAuth認証機能のテストケースを定義します。Docker開発環境での動作確認に使用してください。

## 前提条件
- Docker開発環境が起動している
- 環境変数が正しく設定されている
- Google OAuthクライアントIDが設定されている

## テスト実行前の準備

### 1. コンテナの再起動
```bash
docker compose -f docker-compose.dev.yml down
docker compose -f docker-compose.dev.yml up --build -d
```

### 2. アクセス確認
- フロントエンド: http://localhost:3003
- バックエンド: http://localhost:3001/health

## テストケース

### 1. 基本動作確認

#### 1.1 ホームページ（選択画面）
- **URL**: http://localhost:3003
- **テスト内容**:
  - [ ] 「1段読書へようこそ」が表示される
  - [ ] 「見るだけ」と「使う」ボタンが表示される
  - [ ] メッセージ「完璧じゃなくていい。1ページの前進が、思考と行動を変えていく。」が表示される
  - [ ] ハンバーガーメニューが表示される

#### 1.2 「見るだけ」機能
- **操作**: 「見るだけ」ボタンをクリック
- **期待結果**: タイムライン画面に遷移
- **テスト内容**:
  - [ ] タイムライン画面が表示される
  - [ ] 既存の読書記録が表示される（あれば）
  - [ ] いいね機能が動作する

#### 1.3 「使う」機能
- **操作**: 「使う」ボタンをクリック
- **期待結果**: 認証画面に遷移
- **テスト内容**:
  - [ ] 「ログイン」画面が表示される
  - [ ] Googleログインボタンが表示される
  - [ ] 「戻る」ボタンが機能する
  - [ ] ホームページに戻る

### 2. Google認証テスト

#### 2.1 Googleログインボタン
- **操作**: Googleログインボタンをクリック
- **期待結果**: GoogleのOAuth画面が開く
- **テスト内容**:
  - [ ] Googleの認証画面が表示される
  - [ ] アカウント選択画面が表示される
  - [ ] 複数のGoogleアカウントがある場合は選択可能

#### 2.2 認証成功フロー
- **操作**: Googleアカウントでログイン
- **期待結果**: 入力画面に自動遷移
- **テスト内容**:
  - [ ] 入力画面が表示される
  - [ ] ハンバーガーメニューに「入力画面」「マイページ」が表示される
  - [ ] 「ログアウト」ボタンが表示される
  - [ ] ユーザー情報が正しく取得される

#### 2.3 認証エラー処理
- **操作**: 認証をキャンセルまたはエラーが発生
- **期待結果**: 適切なエラーメッセージが表示される
- **テスト内容**:
  - [ ] エラーメッセージが表示される
  - [ ] 認証画面に戻る
  - [ ] 再認証が可能

### 3. 認証後の機能テスト

#### 3.1 入力画面
- **URL**: http://localhost:3003/input
- **テスト内容**:
  - [ ] 認証済みユーザーのみアクセス可能
  - [ ] フォームが正常に表示される
  - [ ] 各入力フィールドが機能する
  - [ ] 投稿機能が動作する
  - [ ] 投稿成功後にメッセージが表示される

#### 3.2 マイページ
- **URL**: http://localhost:3003/mypage
- **テスト内容**:
  - [ ] 認証済みユーザーのみアクセス可能
  - [ ] ユーザーの投稿が表示される
  - [ ] 投稿の詳細情報が正しく表示される
  - [ ] リンクが正常に機能する

#### 3.3 ログアウト機能
- **操作**: ハンバーガーメニューから「ログアウト」をクリック
- **期待結果**: ホームページに戻る
- **テスト内容**:
  - [ ] ホームページ（選択画面）に戻る
  - [ ] ハンバーガーメニューから認証が必要な項目が消える
  - [ ] 認証情報がクリアされる

### 4. セキュリティテスト

#### 4.1 未認証アクセス制限
- **操作**: ログアウト状態で `/input` や `/mypage` に直接アクセス
- **期待結果**: 認証画面にリダイレクト
- **テスト内容**:
  - [ ] 自動的に認証画面に遷移する
  - [ ] 適切なエラーメッセージが表示される

#### 4.2 タイムラインアクセス
- **操作**: 未認証状態で `/timeline` にアクセス
- **期待結果**: 正常にアクセス可能
- **テスト内容**:
  - [ ] タイムラインが表示される
  - [ ] いいね機能が動作する
  - [ ] セッションIDが正常に生成される

#### 4.3 JWTトークン検証
- **操作**: 無効なトークンでAPIリクエスト
- **期待結果**: 401エラーが返される
- **テスト内容**:
  - [ ] 適切なエラーレスポンスが返される
  - [ ] 認証画面にリダイレクトされる

### 5. エラーハンドリングテスト

#### 5.1 ネットワークエラー
- **操作**: ネットワーク接続を切断して認証を試行
- **期待結果**: 適切なエラーメッセージ
- **テスト内容**:
  - [ ] エラーメッセージが表示される
  - [ ] 再試行が可能

#### 5.2 サーバーエラー
- **操作**: バックエンドサーバーを停止して認証を試行
- **期待結果**: 適切なエラーメッセージ
- **テスト内容**:
  - [ ] エラーメッセージが表示される
  - [ ] サーバー復旧後に再認証が可能

### 6. レスポンシブテスト

#### 6.1 スマホサイズ
- **操作**: ブラウザの開発者ツールでスマホサイズに変更
- **テスト内容**:
  - [ ] 各画面が適切に表示される
  - [ ] ボタンがタップしやすいサイズ
  - [ ] テキストが読みやすいサイズ
  - [ ] Googleログインボタンが正常に表示される

#### 6.2 タブレットサイズ
- **操作**: ブラウザの開発者ツールでタブレットサイズに変更
- **テスト内容**:
  - [ ] レイアウトが適切に調整される
  - [ ] 各機能が正常に動作する

### 7. ブラウザ互換性テスト

#### 7.1 Chrome
- **テスト内容**:
  - [ ] Google認証が正常に動作する
  - [ ] 各機能が正常に動作する
  - [ ] エラーが発生しない

#### 7.2 Firefox
- **テスト内容**:
  - [ ] Google認証が正常に動作する
  - [ ] 各機能が正常に動作する
  - [ ] エラーが発生しない

#### 7.3 Safari
- **テスト内容**:
  - [ ] Google認証が正常に動作する
  - [ ] 各機能が正常に動作する
  - [ ] エラーが発生しない

### 8. パフォーマンステスト

#### 8.1 ページ読み込み速度
- **テスト内容**:
  - [ ] ホームページが3秒以内に読み込まれる
  - [ ] 認証画面が3秒以内に読み込まれる
  - [ ] 入力画面が3秒以内に読み込まれる

#### 8.2 認証処理速度
- **テスト内容**:
  - [ ] Google認証が5秒以内に完了する
  - [ ] トークン生成が1秒以内に完了する

## 問題発生時の対処法

### よくある問題と解決方法

#### 1. Google認証が動作しない
- **原因**: クライアントIDが正しく設定されていない
- **解決方法**: 環境変数 `VITE_GOOGLE_CLIENT_ID` を確認

#### 2. 認証後にエラーが発生
- **原因**: バックエンドの環境変数が正しく設定されていない
- **解決方法**: `backend/.env` の設定を確認

#### 3. ページが表示されない
- **原因**: Dockerコンテナが正常に起動していない
- **解決方法**: `docker compose ps` でコンテナの状態を確認

### ログ確認方法

#### フロントエンドログ
```bash
docker compose -f docker-compose.dev.yml logs frontend
```

#### バックエンドログ
```bash
docker compose -f docker-compose.dev.yml logs backend
```

## テスト完了基準

すべてのテストケースで以下が確認できた場合、テスト完了とします：

- [ ] 基本動作確認が完了
- [ ] Google認証が正常に動作
- [ ] セキュリティ機能が正常に動作
- [ ] エラーハンドリングが適切に動作
- [ ] レスポンシブデザインが正常に動作
- [ ] 主要ブラウザで動作確認済み

## 更新履歴

- **2024-01-XX**: 初版作成
